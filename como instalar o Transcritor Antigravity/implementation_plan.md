# Fix Transcription Display Issue

## Problem Description

The audio transcription application is detecting new audio files in the monitored folder and shows the message "[14:43:37] Novo arquivo processado:" but the actual transcription text is not appearing below it. This suggests that the transcription is either:
1. Not being generated by the Deepgram API
2. Not being properly extracted from the API response
3. Getting lost in the queue communication

## Root Cause Analysis

Looking at the code flow:
1. `AudioFileHandler.handle_event()` detects file â†’ calls `process_file_thread()`
2. `process_file()` sends file to Deepgram API
3. `format_diarized_transcript()` formats the response
4. Formatted text is sent through queue with type "transcription"
5. `check_queue()` receives it and calls `append_text()`
6. `append_text()` shows "[HH:MM:SS] Novo arquivo processado:" but the `text` parameter appears to be empty

The issue is likely in `format_diarized_transcript()` which may be:
- Throwing an exception silently
- Returning an empty string
- Not extracting the text properly from the API response

## Proposed Changes

### [MODIFY] [main.py](file:///c:/Users/ferna/OneDrive/Documentos/Projetos%20AntiGravity/audio_transcriptor_fernando/main.py)

**Changes to implement:**

1. **Add comprehensive logging in `format_diarized_transcript()` (lines 133-167)**
   - Log the response structure
   - Log each step of text extraction
   - Log the final formatted text length

2. **Add logging in `process_file()` (lines 173-219)**
   - Log after API call succeeds
   - Log the formatted transcript before queueing
   - Log any exceptions with full traceback

3. **Add safety check in `append_text()` (lines 280-286)**
   - Check if text is empty before displaying
   - Show a message if transcription is empty

4. **Add exception details to queue error messages**
   - Include traceback information for debugging

## Verification Plan

### Automated Tests
1. Check the console output for debug messages
2. Save a short audio file to the monitored folder
3. Verify the transcription appears in the UI

### Manual Verification
1. User will test with their actual recording workflow
2. Confirm transcription displays correctly with speaker diarization
